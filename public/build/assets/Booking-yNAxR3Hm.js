import{d as P,x as M,r as w,b as B,w as V,c as l,o as a,a as t,e as m,t as d,f as O,g as c,v as x,u as r,h as j,i as I,F as z,j as A,k as F,W as L}from"./app-p4oQ-QsI.js";const R={class:"min-h-screen bg-gray-50 py-10 px-4 flex justify-center"},H={key:0,class:"w-full max-w-4xl bg-white rounded-2xl shadow-lg p-8 grid grid-cols-1 md:grid-cols-2 gap-8"},Q={class:"space-y-5"},W={class:"text-2xl font-bold text-center text-[#002B5C] mb-6"},Y={key:0,class:"bg-green-100 text-green-800 p-3 rounded-lg mb-4 text-sm"},G={key:1,class:"bg-red-100 text-red-800 p-3 rounded-lg mb-4 text-sm"},J={key:2,class:"bg-red-100 text-red-800 p-3 rounded-lg mb-4 text-sm"},K={key:3,class:"bg-red-100 text-red-800 p-3 rounded-lg mb-4 text-sm"},X={key:0,class:"text-red-600 text-sm mt-1"},Z={key:0,class:"text-red-600 text-sm mt-1"},ee={key:0,class:"text-red-600 text-sm mt-1"},te={key:0,class:"text-red-600 text-sm mt-1"},oe={key:0,class:"text-red-600 text-sm mt-1"},se={key:0,class:"text-red-600 text-sm mt-1"},re={key:0,class:"text-red-600 text-sm mt-1"},ne={key:0,class:"mt-6"},ie={class:"text-sm font-semibold text-gray-700 mb-2"},le={class:"overflow-x-auto"},ae={key:0,class:"min-w-full bg-white border border-gray-200 rounded-lg"},de={class:"divide-y divide-gray-200"},ue={class:"px-4 py-2 text-sm text-gray-900 font-medium"},me={class:"px-4 py-2 text-sm text-gray-900"},ge={key:1,class:"text-sm text-gray-500 italic"},fe=["disabled"],pe={key:0},ce={key:1},be={class:"space-y-5"},ye={class:"flex justify-center"},_e=["src"],xe={class:"text-gray-900"},ke={class:"text-gray-900"},ve={class:"text-gray-900"},he={class:"text-gray-900"},we={class:"text-gray-900"},Be=["src"],$e={key:1,class:"text-red-600 font-medium"},De=P({__name:"Booking",props:{shop:{},errors:{},bookings:{}},setup(C){const b=C,y="",o=M({name:"",email:"",size_of_the_car:"",contact_no:"",time_of_booking:"",date_of_booking:"",slot_number:1}),k=w(""),_=w(""),v=w(b.bookings||[]),N=B(()=>o.date_of_booking?new Date(o.date_of_booking).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),$=B(()=>{if(!o.date_of_booking)return[];const n=o.date_of_booking,e=v.value.filter(s=>s.date_of_booking===n),i={};e.forEach(s=>{const u=`${s.time_of_booking}-${s.slot_number}`;i[u]||(i[u]={id:s.id,time:s.time_of_booking,slot:s.slot_number,takenBy:""}),s.name?i[u].takenBy===""?i[u].takenBy=s.name:i[u].takenBy!==s.name&&(i[u].takenBy="Multiple"):i[u].takenBy===""&&(i[u].takenBy="Unknown")});const g=Object.values(i);return g.sort((s,u)=>{const f=new Date(`2000-01-01T${s.time}:00`).getTime(),p=new Date(`2000-01-01T${u.time}:00`).getTime();return f-p}),g}),S=B(()=>{if(!o.date_of_booking||!o.time_of_booking||!o.slot_number)return!1;const n=new Date(`${o.date_of_booking}T${o.time_of_booking}:00`),e=new Date(n.getTime()+3*60*60*1e3);return v.value.some(i=>{const g=new Date(`${i.date_of_booking}T${i.time_of_booking}:00`),s=new Date(g.getTime()+3*60*60*1e3);return i.slot_number===o.slot_number&&g<e&&n<s})}),D=(n,e)=>{const i=n.target;i&&(i.src=e)},T=async n=>{var u;if(!n||!((u=b.shop)!=null&&u.id))return;const e=[],i=new Date(n);e.push(i.toISOString().split("T")[0]),e.push(new Date(i.getTime()-24*60*60*1e3).toISOString().split("T")[0]),e.push(new Date(i.getTime()+24*60*60*1e3).toISOString().split("T")[0]);const g=[];for(const f of[...new Set(e)])try{const p=await F.get(`/shops/${b.shop.id}/availability?date=${f}`);g.push(...p.data.bookings)}catch(p){console.warn(`No bookings found for ${f}:`,p)}const s=g.filter((f,p,E)=>p===E.findIndex(h=>h.date_of_booking===f.date_of_booking&&h.time_of_booking===f.time_of_booking&&h.slot_number===f.slot_number));v.value=s},q=()=>{o.isDirty&&!confirm("You have unsaved changes. Are you sure you want to leave?")||L.visit(route("dashboard"))},U=()=>{var n;if(k.value="",_.value="",!((n=b.shop)!=null&&n.id)){k.value="Invalid shop ID. Please select a valid shop.";return}if(S.value){_.value="This slot is already booked within the next 3 hours. Please choose a different time or slot.";return}o.post(`/customer/book/${b.shop.id}/payment`,{onSuccess:()=>console.log("Booking submitted successfully, redirected to payment"),onError:e=>{console.error("Booking submission errors:",e),Object.keys(e).length>0?(o.errors={...o.errors,...e},e.time_of_booking&&(_.value=e.time_of_booking)):_.value="An unexpected error occurred. Please try again."}})};return V(()=>o.date_of_booking,n=>{n&&T(n)}),V(()=>b.shop,n=>{console.log("Shop updated:",n),n!=null&&n.id&&o.date_of_booking&&T(o.date_of_booking)}),(n,e)=>{var i,g;return a(),l("div",R,[n.shop?(a(),l("div",H,[t("div",Q,[t("h1",W," Book at "+d(n.shop.name),1),(i=n.$page.props.flash)!=null&&i.success?(a(),l("div",Y,d(n.$page.props.flash.success),1)):m("",!0),(g=n.$page.props.flash)!=null&&g.error?(a(),l("div",G,d(n.$page.props.flash.error),1)):m("",!0),k.value?(a(),l("div",J,d(k.value),1)):m("",!0),_.value?(a(),l("div",K,d(_.value),1)):m("",!0),t("form",{onSubmit:O(U,["prevent"]),class:"space-y-5"},[t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-semibold text-gray-700"},"Your Name",-1)),c(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>r(o).name=s),class:"w-full mt-1 p-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-[#002B5C] focus:outline-none",required:""},null,512),[[x,r(o).name]]),r(o).errors.name?(a(),l("div",X,d(r(o).errors.name),1)):m("",!0)]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-semibold text-gray-700"},"Email Address",-1)),c(t("input",{type:"email","onUpdate:modelValue":e[1]||(e[1]=s=>r(o).email=s),class:"w-full mt-1 p-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-[#002B5C] focus:outline-none",required:""},null,512),[[x,r(o).email]]),r(o).errors.email?(a(),l("div",Z,d(r(o).errors.email),1)):m("",!0)]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-semibold text-gray-700"},"Size of the Car",-1)),c(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>r(o).size_of_the_car=s),class:"w-full mt-1 p-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-[#002B5C] focus:outline-none",required:""},[...e[11]||(e[11]=[I('<option value="">Select</option><option value="HatchBack">HatchBack</option><option value="Sedan">Sedan</option><option value="MPV">MPV</option><option value="SUV">SUV</option><option value="Pickup">Pickup</option><option value="Van">Van</option><option value="Motorcycle">Motorcycle</option>',8)])],512),[[j,r(o).size_of_the_car]]),r(o).errors.size_of_the_car?(a(),l("div",ee,d(r(o).errors.size_of_the_car),1)):m("",!0)]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-semibold text-gray-700"},"Contact Number",-1)),c(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=s=>r(o).contact_no=s),class:"w-full mt-1 p-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-[#002B5C] focus:outline-none",required:""},null,512),[[x,r(o).contact_no]]),r(o).errors.contact_no?(a(),l("div",te,d(r(o).errors.contact_no),1)):m("",!0)]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-semibold text-gray-700"},"Time of Booking",-1)),c(t("input",{type:"time","onUpdate:modelValue":e[4]||(e[4]=s=>r(o).time_of_booking=s),class:"w-full mt-1 p-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-[#002B5C] focus:outline-none",required:""},null,512),[[x,r(o).time_of_booking]]),r(o).errors.time_of_booking?(a(),l("div",oe,d(r(o).errors.time_of_booking),1)):m("",!0)]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-semibold text-gray-700"},"Date of Booking",-1)),c(t("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=s=>r(o).date_of_booking=s),class:"w-full mt-1 p-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-[#002B5C] focus:outline-none",required:""},null,512),[[x,r(o).date_of_booking]]),r(o).errors.date_of_booking?(a(),l("div",se,d(r(o).errors.date_of_booking),1)):m("",!0)]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-semibold text-gray-700"},"Slot Number",-1)),c(t("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=s=>r(o).slot_number=s),min:"1",max:"4",class:"w-full mt-1 p-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-[#002B5C] focus:outline-none",required:""},null,512),[[x,r(o).slot_number]]),r(o).errors.slot_number?(a(),l("div",re,d(r(o).errors.slot_number),1)):m("",!0)]),r(o).date_of_booking?(a(),l("div",ne,[t("h3",ie,"Taken Slots on "+d(N.value)+" (View Only)",1),t("div",le,[$.value.length>0?(a(),l("table",ae,[e[18]||(e[18]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Time"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Slot"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Status")])],-1)),t("tbody",de,[(a(!0),l(z,null,A($.value,s=>(a(),l("tr",{key:`${s.time}-${s.slot}-${s.id||0}`,class:"bg-red-50 border-l-4 border-red-400 hover:bg-red-100"},[t("td",ue,d(s.time),1),t("td",me,"#"+d(s.slot),1),e[17]||(e[17]=t("td",{class:"px-4 py-2 text-sm"},[t("span",{class:"text-red-600 font-semibold"},"Taken")],-1))]))),128))])])):(a(),l("p",ge,"No taken slots on this date yet."))]),e[19]||(e[19]=t("p",{class:"text-xs text-gray-500 mt-2"},"Bookings are sorted by time. Each lasts 3 hours; avoid overlaps.",-1))])):m("",!0),t("button",{type:"button",onClick:q,class:"w-full bg-gray-500 text-white py-2 rounded-lg font-semibold hover:bg-gray-600 transition"}," Return to Dashboard "),t("button",{type:"submit",class:"w-full bg-[#FF2D2D] text-white py-2 rounded-lg font-semibold hover:bg-red-700 transition disabled:opacity-50",disabled:r(o).processing||S.value},[r(o).processing?(a(),l("span",pe,"Processing...")):(a(),l("span",ce,"Pay Now"))],8,fe)],32)]),t("div",be,[e[26]||(e[26]=t("h2",{class:"text-xl font-semibold text-[#002B5C] mb-4"},"Shop Details",-1)),t("div",ye,[t("img",{src:n.shop.logo?`${r(y)}/storage/${n.shop.logo}`:`${r(y)}`,onError:e[7]||(e[7]=s=>D(s,`${r(y)}/images/default-carwash.png`)),alt:"Shop Logo",class:"h-24 w-24 object-contain rounded-lg border border-gray-200"},null,40,_e)]),t("div",null,[e[20]||(e[20]=t("h3",{class:"text-sm font-semibold text-gray-700"},"Name",-1)),t("p",xe,d(n.shop.name),1)]),t("div",null,[e[21]||(e[21]=t("h3",{class:"text-sm font-semibold text-gray-700"},"Address",-1)),t("p",ke,d(n.shop.address),1)]),t("div",null,[e[22]||(e[22]=t("h3",{class:"text-sm font-semibold text-gray-700"},"District",-1)),t("p",ve,d(n.shop.district||"Not specified"),1)]),t("div",null,[e[23]||(e[23]=t("h3",{class:"text-sm font-semibold text-gray-700"},"Description",-1)),t("p",he,d(n.shop.description||"No description available"),1)]),t("div",null,[e[24]||(e[24]=t("h3",{class:"text-sm font-semibold text-gray-700"},"Services Offered",-1)),t("p",we,d(n.shop.services_offered||"No services listed"),1)]),t("div",null,[e[25]||(e[25]=t("h3",{class:"text-sm font-semibold text-gray-700"},"QR Code",-1)),t("img",{src:n.shop.qr_code?`${r(y)}/storage/${n.shop.qr_code}`:`${r(y)}/images/default-qr.png`,onError:e[8]||(e[8]=s=>D(s,`${r(y)}/images/default-qr.png`)),alt:"Shop QR Code",class:"h-32 w-32 object-contain rounded-lg border border-gray-200"},null,40,Be)])])])):(a(),l("div",$e,"Shop not found. Please select a valid shop."))])}}});export{De as default};
