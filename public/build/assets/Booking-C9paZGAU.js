import{d as P,r as g,x as L,b as k,w as S,c as a,o as d,e as c,a as t,t as u,f as O,g as p,v as m,u as i,h as z,i as h,F as V,j as W,W as A,k as H}from"./app-DMXauu5P.js";const Y={key:0,class:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50"},G=["src"],J={class:"min-h-screen bg-gray-50 py-6 px-4 sm:px-6 flex justify-center"},K={key:0,class:"w-full max-w-3xl bg-white rounded-2xl shadow-lg p-6 sm:p-8 grid grid-cols-1 md:grid-cols-2 gap-6"},Z={class:"space-y-4"},ee={class:"text-xl sm:text-2xl font-bold text-center text-[#002B5C] mb-4"},te={key:0,class:"bg-red-100 text-red-800 p-2 rounded-lg text-sm"},oe={key:1,class:"bg-red-100 text-red-800 p-2 rounded-lg text-sm"},se=["min"],ne=["min"],re={key:0,class:"text-red-600 text-sm mt-1"},le={key:0,class:"mt-4"},ie={class:"text-sm font-semibold text-gray-700 mb-2"},ae={class:"overflow-x-auto"},de={key:0,class:"min-w-full bg-white border rounded"},ue={class:"px-2 py-1 text-sm"},ce={class:"px-2 py-1 text-sm"},pe={key:1,class:"text-xs text-gray-500 italic"},me=["disabled"],fe={class:"space-y-4"},ge={class:"flex justify-center"},be=["src"],_e={key:0,class:"mt-4"},he={class:"overflow-x-auto"},ve={class:"min-w-full border rounded"},ye={class:"px-3 py-3 text-center"},ke=["src"],we={class:"px-3 py-3 text-center"},xe=["src"],De={class:"px-3 py-3 text-center"},Ce=["src"],Se={class:"px-3 py-3 text-center"},qe=["src"],$e={class:"px-3 py-3 text-center"},Be=["src"],Te={key:1,class:"text-red-600 font-medium text-center mt-10"},Qe=P({__name:"Booking",props:{shop:{},errors:{},bookings:{}},setup(Q){const w=g(!1),q=g("");function b(o){o&&(q.value=o,w.value=!0)}const f=Q,n=L({name:"",email:"",size_of_the_car:"",contact_no:"",time_of_booking:"",date_of_booking:"",slot_number:1,services_offered:""}),v=g(""),y=g(""),x=g(f.bookings||[]),R=k(()=>n.date_of_booking?new Date(n.date_of_booking).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),$=k(()=>{if(!n.date_of_booking)return[];const o=n.date_of_booking,e=x.value.filter(r=>r.date_of_booking===o),s={};return e.forEach(r=>{const l=`${r.time_of_booking}-${r.slot_number}`;s[l]||(s[l]={id:r.id,time:r.time_of_booking,slot:r.slot_number,takenBy:""}),r.name?s[l].takenBy=s[l].takenBy&&s[l].takenBy!==r.name?"Multiple":r.name:s[l].takenBy||(s[l].takenBy="Unknown")}),Object.values(s).sort((r,l)=>new Date(`2000-01-01T${r.time}:00`).getTime()-new Date(`2000-01-01T${l.time}:00`).getTime())}),B=k(()=>{if(!n.date_of_booking||!n.time_of_booking||!n.slot_number)return!1;const o=new Date(`${n.date_of_booking}T${n.time_of_booking}:00`),e=new Date(o.getTime()+3*60*60*1e3);return x.value.some(s=>{const r=new Date(`${s.date_of_booking}T${s.time_of_booking}:00`),l=new Date(r.getTime()+3*60*60*1e3);return s.slot_number===n.slot_number&&r<e&&o<l})}),T=async o=>{var r;if(!o||!((r=f.shop)!=null&&r.id))return;const e=[new Date(o),new Date(o).setDate(new Date(o).getDate()-1),new Date(o).setDate(new Date(o).getDate()+1)].map(l=>new Date(l).toISOString().split("T")[0]),s=[];for(const l of[...new Set(e)])try{const D=await H.get(`/shops/${f.shop.id}/availability?date=${l}`);s.push(...D.data.bookings)}catch{}x.value=s.filter((l,D,I)=>D===I.findIndex(C=>C.date_of_booking===l.date_of_booking&&C.time_of_booking===l.time_of_booking&&C.slot_number===l.slot_number))},U=()=>A.visit(route("dashboard")),j=()=>{var o;if(v.value="",y.value="",!((o=f.shop)!=null&&o.id)){v.value="Invalid shop ID";return}if(B.value){y.value="This slot is already booked";return}n.post(`/customer/book/${f.shop.id}/payment`)},N=window.location.origin;function X(o){var e;return(e=o.logo)!=null&&e.startsWith("http")?o.logo:`/storage/${o.logo}`||"/images/default-carwash.png"}function E(o){const e=o.target;e&&(e.src=`${N}/images/default-carwash.png`)}S(()=>n.date_of_booking,T),S(()=>f.shop,o=>{o!=null&&o.id&&n.date_of_booking&&T(n.date_of_booking)});function M(o){const e=o.target;e.value=e.value.replace(/\D/g,"").slice(0,11),n.contact_no=e.value}const F=k(()=>{const o=new Date,e=o.getFullYear(),s=String(o.getMonth()+1).padStart(2,"0"),r=String(o.getDate()).padStart(2,"0");return`${e}-${s}-${r}`}),_=g("00:00");return S(()=>n.date_of_booking,o=>{if(!o)return;const e=new Date;if(new Date(o).toDateString()===e.toDateString()){const r=e.getHours().toString().padStart(2,"0"),l=e.getMinutes().toString().padStart(2,"0");_.value=`${r}:${l}`,n.time_of_booking<_.value&&(n.time_of_booking=_.value)}else _.value="00:00"},{immediate:!0}),(o,e)=>(d(),a(V,null,[w.value?(d(),a("div",Y,[t("img",{src:q.value,alt:"QR Code Preview",class:"max-h-[80vh] rounded-xl shadow-2xl border-4 border-white"},null,8,G),t("button",{onClick:e[0]||(e[0]=s=>w.value=!1),class:"absolute top-6 right-8 text-white text-3xl font-bold"}," âœ• ")])):c("",!0),t("div",J,[o.shop?(d(),a("div",K,[t("div",Z,[t("h1",ee,"Book at "+u(o.shop.name),1),v.value?(d(),a("div",te,u(v.value),1)):c("",!0),y.value?(d(),a("div",oe,u(y.value),1)):c("",!0),t("form",{onSubmit:O(j,["prevent"]),class:"space-y-4"},[p(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=s=>i(n).name=s),placeholder:"Your Name",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[m,i(n).name]]),p(t("input",{type:"email","onUpdate:modelValue":e[2]||(e[2]=s=>i(n).email=s),placeholder:"Email Address",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[m,i(n).email]]),p(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>i(n).size_of_the_car=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},[...e[14]||(e[14]=[t("option",{value:""},"Select Car Types",-1),t("option",null,"HatchBack",-1),t("option",null,"Sedan",-1),t("option",null,"MPV",-1),t("option",null,"SUV",-1),t("option",null,"Pickup",-1),t("option",null,"Van",-1),t("option",null,"Motorcycle",-1)])],512),[[z,i(n).size_of_the_car]]),p(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=s=>i(n).contact_no=s),placeholder:"09XXXXXXXXX",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:"",maxlength:"11",onInput:M},null,544),[[m,i(n).contact_no]]),p(t("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=s=>i(n).date_of_booking=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:"",min:F.value},null,8,se),[[m,i(n).date_of_booking]]),p(t("input",{type:"time","onUpdate:modelValue":e[6]||(e[6]=s=>i(n).time_of_booking=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:"",min:_.value},null,8,ne),[[m,i(n).time_of_booking]]),p(t("input",{type:"number","onUpdate:modelValue":e[7]||(e[7]=s=>i(n).slot_number=s),min:"1",max:"4",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[m,i(n).slot_number]]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-semibold text-gray-700"},"Services Requested",-1)),t("p",null,[e[15]||(e[15]=t("span",{class:"font-semibold"},"Services Offered:",-1)),h(" "+u(o.shop.services_offered||"No services listed"),1)]),p(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=s=>i(n).services_offered=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",placeholder:"Specify services you want",rows:"3"},null,512),[[m,i(n).services_offered]]),i(n).errors.services_offered?(d(),a("div",re,u(i(n).errors.services_offered),1)):c("",!0)]),i(n).date_of_booking?(d(),a("div",le,[t("h3",ie,"Taken Slots on "+u(R.value)+" (View Only)",1),t("div",ae,[$.value.length?(d(),a("table",de,[e[18]||(e[18]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",null,"Time"),t("th",null,"Slot"),t("th",null,"Status")])],-1)),t("tbody",null,[(d(!0),a(V,null,W($.value,s=>(d(),a("tr",{key:`${s.time}-${s.slot}-${s.id||0}`,class:"bg-red-50 border-l-4 border-red-400"},[t("td",ue,u(s.time),1),t("td",ce,"#"+u(s.slot),1),e[17]||(e[17]=t("td",{class:"px-2 py-1 text-sm text-red-600 font-semibold"},"Taken",-1))]))),128))])])):(d(),a("p",pe,"No taken slots yet."))])])):c("",!0),t("button",{type:"button",onClick:U,class:"w-full bg-gray-500 text-white py-2 rounded hover:bg-gray-600 transition"},"Return"),t("button",{type:"submit",class:"w-full bg-[#FF2D2D] text-white py-2 rounded hover:bg-red-700 transition",disabled:i(n).processing||B.value},"Pay Now",8,me)],32)]),t("div",fe,[e[25]||(e[25]=t("h2",{class:"text-lg font-semibold text-[#002B5C mb-2"},"Shop Details",-1)),t("div",ge,[t("img",{src:X(o.shop),alt:"Car Wash Logo",class:"h-20 w-20 object-contain mb-2",onError:E},null,40,be)]),t("p",null,[e[19]||(e[19]=t("span",{class:"font-semibold"},"Name:",-1)),h(" "+u(o.shop.name),1)]),t("p",null,[e[20]||(e[20]=t("span",{class:"font-semibold"},"Address:",-1)),h(" "+u(o.shop.address),1)]),t("p",null,[e[21]||(e[21]=t("span",{class:"font-semibold"},"District:",-1)),h(" "+u(o.shop.district||"Not specified"),1)]),t("p",null,[e[22]||(e[22]=t("span",{class:"font-semibold"},"Description:",-1)),h(" "+u(o.shop.description||"No description"),1)]),o.shop&&(o.shop.qr_code||o.shop.qr_code2||o.shop.qr_code3||o.shop.qr_code4||o.shop.qr_code5)?(d(),a("div",_e,[e[24]||(e[24]=t("h3",{class:"text-sm font-semibold text-gray-700 mb-2"},"QR Codes",-1)),t("div",he,[t("table",ve,[e[23]||(e[23]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-3 py-2 text-center"},"QR Code 1"),t("th",{class:"px-3 py-2 text-center"},"QR Code 2"),t("th",{class:"px-3 py-2 text-center"},"QR Code 3"),t("th",{class:"px-3 py-2 text-center"},"QR Code 4"),t("th",{class:"px-3 py-2 text-center"},"QR Code 5")])],-1)),t("tbody",null,[t("tr",null,[t("td",ye,[o.shop.qr_code?(d(),a("img",{key:0,src:o.shop.qr_code,alt:"QR Code 1",class:"h-12 w-12 object-cover rounded border mx-auto cursor-pointer hover:scale-105 transition",onClick:e[9]||(e[9]=s=>b(o.shop.qr_code))},null,8,ke)):c("",!0)]),t("td",we,[o.shop.qr_code2?(d(),a("img",{key:0,src:o.shop.qr_code2,alt:"QR Code 2",class:"h-12 w-12 object-cover rounded border mx-auto cursor-pointer hover:scale-105 transition",onClick:e[10]||(e[10]=s=>b(o.shop.qr_code2))},null,8,xe)):c("",!0)]),t("td",De,[o.shop.qr_code3?(d(),a("img",{key:0,src:o.shop.qr_code3,alt:"QR Code 3",class:"h-12 w-12 object-cover rounded border mx-auto cursor-pointer hover:scale-105 transition",onClick:e[11]||(e[11]=s=>b(o.shop.qr_code3))},null,8,Ce)):c("",!0)]),t("td",Se,[o.shop.qr_code4?(d(),a("img",{key:0,src:o.shop.qr_code4,alt:"QR Code 4",class:"h-12 w-12 object-cover rounded border mx-auto cursor-pointer hover:scale-105 transition",onClick:e[12]||(e[12]=s=>b(o.shop.qr_code4))},null,8,qe)):c("",!0)]),t("td",$e,[o.shop.qr_code5?(d(),a("img",{key:0,src:o.shop.qr_code5,alt:"QR Code 5",class:"h-12 w-12 object-cover rounded border mx-auto cursor-pointer hover:scale-105 transition",onClick:e[13]||(e[13]=s=>b(o.shop.qr_code5))},null,8,Be)):c("",!0)])])])])])])):c("",!0)])])):(d(),a("div",Te,"Shop not found."))])],64))}});export{Qe as default};
