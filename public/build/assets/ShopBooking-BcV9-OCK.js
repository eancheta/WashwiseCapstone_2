import{d as w,x as S,r as B,w as V,b as D,B as z,c as i,o as r,a as t,t as l,g as u,e as d,v as c,u as n,h as M,F as k,i as g,f as T,k as U,j as N}from"./app-CkzVa1sI.js";const A={class:"p-6 max-w-xl mx-auto"},C={class:"text-2xl font-bold mb-1"},P={class:"text-gray-600 mb-6"},$={key:0,class:"text-red-600 text-sm"},E=["value"],F={key:0,class:"text-red-600 text-sm"},Y={key:0,class:"text-red-600 text-sm"},j={key:0,class:"text-red-600 text-sm"},H={key:0,class:"text-red-600"},I={key:1,class:"text-red-600 text-sm"},L={class:"mt-8"},O={class:"text-lg font-semibold mb-2"},R={class:"space-y-2"},q={class:"text-sm text-gray-600"},K=w({__name:"ShopBooking",props:{shop:{}},setup(x){const b=x,o=S({name:"",size_of_the_car:"",contact_no:"",date_of_booking:"",time_of_booking:""}),_=B([]);async function f(){if(!o.date_of_booking){_.value=[];return}const{data:a}=await U.get(route("shops.bookings.availability",b.shop.id),{params:{date:o.date_of_booking}});_.value=(a==null?void 0:a.bookings)??[]}V(()=>o.date_of_booking,()=>{f()});const v=["HatchBack","Sedan","MPV","SUV","Pickup","Van","Motorcycle"],h=D(()=>_.value.map(a=>{const e=new Date(`${a.date_of_booking}T${a.time_of_booking}`),s=new Date(e.getTime()+3*60*60*1e3);return{slot:a.slot_number,start:e,end:s}}));function p(a){if(!o.date_of_booking||!a)return!0;const e=new Date(`${o.date_of_booking}T${a}`);for(let s=1;s<=4;s++)if(!h.value.some(m=>m.slot===s&&e>=m.start&&e<m.end))return!0;return!1}function y(){if(!p(o.time_of_booking)){alert("All 4 slots are occupied within 3 hours of that time. Please choose another time.");return}o.post(route("shops.bookings.store",b.shop.id),{onSuccess:()=>{alert("Booking successful!");const a=o.date_of_booking;o.reset(),o.date_of_booking=a,f()}})}return z(()=>{const a=new Date().toISOString().slice(0,10);o.date_of_booking=a}),(a,e)=>(r(),i("div",A,[t("h1",C,"Book at "+l(a.shop.name),1),t("p",P,l(a.shop.address)+" • District "+l(a.shop.district),1),t("form",{onSubmit:T(y,["prevent"]),class:"space-y-4"},[t("div",null,[e[5]||(e[5]=t("label",{class:"block mb-1"},"Your Name",-1)),u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>n(o).name=s),class:"border rounded w-full p-2",placeholder:"Your name"},null,512),[[c,n(o).name]]),n(o).errors.name?(r(),i("div",$,l(n(o).errors.name),1)):d("",!0)]),t("div",null,[e[7]||(e[7]=t("label",{class:"block mb-1"},"Car Size",-1)),u(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>n(o).size_of_the_car=s),class:"border rounded w-full p-2"},[e[6]||(e[6]=t("option",{value:""},"Select",-1)),(r(),i(k,null,g(v,s=>t("option",{key:s,value:s},l(s),9,E)),64))],512),[[M,n(o).size_of_the_car]]),n(o).errors.size_of_the_car?(r(),i("div",F,l(n(o).errors.size_of_the_car),1)):d("",!0)]),t("div",null,[e[8]||(e[8]=t("label",{class:"block mb-1"},"Contact No.",-1)),u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>n(o).contact_no=s),class:"border rounded w-full p-2",placeholder:"09xxxxxxxxx"},null,512),[[c,n(o).contact_no]]),n(o).errors.contact_no?(r(),i("div",Y,l(n(o).errors.contact_no),1)):d("",!0)]),t("div",null,[e[9]||(e[9]=t("label",{class:"block mb-1"},"Date",-1)),u(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=s=>n(o).date_of_booking=s),class:"border rounded w-full p-2"},null,512),[[c,n(o).date_of_booking]]),n(o).errors.date_of_booking?(r(),i("div",j,l(n(o).errors.date_of_booking),1)):d("",!0)]),t("div",null,[e[10]||(e[10]=t("label",{class:"block mb-1"},"Time",-1)),u(t("input",{type:"time","onUpdate:modelValue":e[4]||(e[4]=s=>n(o).time_of_booking=s),class:"border rounded w-full p-2",step:"1800"},null,512),[[c,n(o).time_of_booking]]),n(o).date_of_booking&&n(o).time_of_booking&&!p(n(o).time_of_booking)?(r(),i("small",H," All slots are unavailable within 3 hours of that time. Pick another. ")):d("",!0),n(o).errors.time_of_booking?(r(),i("div",I,l(n(o).errors.time_of_booking),1)):d("",!0)]),e[11]||(e[11]=t("button",{type:"submit",class:"bg-blue-600 text-white px-4 py-2 rounded"},"Book",-1))],32),t("div",L,[t("h2",O,"Existing bookings ("+l(n(o).date_of_booking||"—")+")",1),t("ul",R,[(r(!0),i(k,null,g(_.value,s=>(r(),i("li",{key:s.id,class:"border rounded p-3"},[t("div",null,[t("strong",null,"Slot #"+l(s.slot_number),1),N(" — "+l(s.time_of_booking)+" ("+l(s.size_of_the_car)+")",1)]),t("div",q,"By "+l(s.name)+" • "+l(s.contact_no),1)]))),128))])])]))}});export{K as default};
