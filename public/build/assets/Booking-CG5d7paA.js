import{d as I,r as b,x as O,c as y,w as S,a as i,o as l,b as c,e as o,t as u,f as P,g as p,v as f,u as d,h as L,F as V,i as z,W as A,j as k,k as H}from"./app-CT0D4es_.js";const Y={key:0,class:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50"},G=["src"],J={class:"min-h-screen bg-gray-50 py-6 px-4 sm:px-6 flex justify-center"},K={key:0,class:"w-full max-w-3xl bg-white rounded-2xl shadow-lg p-6 sm:p-8 grid grid-cols-1 md:grid-cols-2 gap-6"},Z={class:"space-y-4"},ee={class:"text-xl sm:text-2xl font-bold text-center text-[#002B5C] mb-4"},te={key:0,class:"bg-red-100 text-red-800 p-2 rounded-lg text-sm"},oe={key:1,class:"bg-red-100 text-red-800 p-2 rounded-lg text-sm"},se=["min"],ne=["min"],re={key:0},ie={key:0},le=["src"],ae={key:1,class:"text-gray-700 text-sm"},de={key:1,class:"text-gray-500 italic text-sm"},ue={key:2,class:"text-red-600 text-sm mt-1"},ce={key:0,class:"mt-4"},pe={class:"text-sm font-semibold text-gray-700 mb-2"},fe={class:"overflow-x-auto"},me={key:0,class:"min-w-full bg-white border rounded"},ge={class:"px-2 py-1 text-sm"},be={class:"px-2 py-1 text-sm"},he={key:1,class:"text-xs text-gray-500 italic"},_e=["disabled"],ve={class:"space-y-4"},ye={class:"flex justify-center"},ke=["src"],we={key:0,class:"mt-4"},xe={class:"overflow-x-auto"},De={class:"min-w-full border rounded"},Ce={class:"px-3 py-3 text-center"},Se=["src"],$e={class:"px-3 py-3 text-center"},qe=["src"],Be={class:"px-3 py-3 text-center"},Te=["src"],Ve={class:"px-3 py-3 text-center"},je=["src"],Qe={class:"px-3 py-3 text-center"},Re=["src"],Ue={key:1,class:"text-red-600 font-medium text-center mt-10"},Xe=I({__name:"Booking",props:{shop:{},errors:{},bookings:{}},setup(j){const w=b(!1),$=b("");function m(t){t&&($.value=t,w.value=!0)}const g=j,n=O({name:"",email:"",size_of_the_car:"",contact_no:"",time_of_booking:"",date_of_booking:"",slot_number:1,services_offered:""}),_=b(""),v=b(""),x=b(g.bookings||[]),Q=y(()=>n.date_of_booking?new Date(n.date_of_booking).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),q=y(()=>{if(!n.date_of_booking)return[];const t=n.date_of_booking,e=x.value.filter(r=>r.date_of_booking===t),s={};return e.forEach(r=>{const a=`${r.time_of_booking}-${r.slot_number}`;s[a]||(s[a]={id:r.id,time:r.time_of_booking,slot:r.slot_number,takenBy:""}),r.name?s[a].takenBy=s[a].takenBy&&s[a].takenBy!==r.name?"Multiple":r.name:s[a].takenBy||(s[a].takenBy="Unknown")}),Object.values(s).sort((r,a)=>new Date(`2000-01-01T${r.time}:00`).getTime()-new Date(`2000-01-01T${a.time}:00`).getTime())}),B=y(()=>{if(!n.date_of_booking||!n.time_of_booking||!n.slot_number)return!1;const t=new Date(`${n.date_of_booking}T${n.time_of_booking}:00`),e=new Date(t.getTime()+3*60*60*1e3);return x.value.some(s=>{const r=new Date(`${s.date_of_booking}T${s.time_of_booking}:00`),a=new Date(r.getTime()+3*60*60*1e3);return s.slot_number===n.slot_number&&r<e&&t<a})}),T=async t=>{var r;if(!t||!((r=g.shop)!=null&&r.id))return;const e=[new Date(t),new Date(t).setDate(new Date(t).getDate()-1),new Date(t).setDate(new Date(t).getDate()+1)].map(a=>new Date(a).toISOString().split("T")[0]),s=[];for(const a of[...new Set(e)])try{const D=await H.get(`/shops/${g.shop.id}/availability?date=${a}`);s.push(...D.data.bookings)}catch{}x.value=s.filter((a,D,F)=>D===F.findIndex(C=>C.date_of_booking===a.date_of_booking&&C.time_of_booking===a.time_of_booking&&C.slot_number===a.slot_number))},R=()=>A.visit(route("dashboard")),U=()=>{var t;if(_.value="",v.value="",!((t=g.shop)!=null&&t.id)){_.value="Invalid shop ID";return}if(B.value){v.value="This slot is already booked";return}n.post(`/customer/book/${g.shop.id}/payment`)},N=window.location.origin;function X(t){var e;return(e=t.logo)!=null&&e.startsWith("http")?t.logo:`/storage/${t.logo}`||"/images/default-carwash.png"}function E(t){const e=t.target;e&&(e.src=`${N}/images/default-carwash.png`)}S(()=>n.date_of_booking,T),S(()=>g.shop,t=>{t!=null&&t.id&&n.date_of_booking&&T(n.date_of_booking)});function M(t){const e=t.target;e.value=e.value.replace(/\D/g,"").slice(0,11),n.contact_no=e.value}const W=y(()=>{const t=new Date,e=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${s}-${r}`}),h=b("00:00");return S(()=>n.date_of_booking,t=>{if(!t)return;const e=new Date;if(new Date(t).toDateString()===e.toDateString()){const r=e.getHours().toString().padStart(2,"0"),a=e.getMinutes().toString().padStart(2,"0");h.value=`${r}:${a}`,n.time_of_booking<h.value&&(n.time_of_booking=h.value)}else h.value="00:00"},{immediate:!0}),(t,e)=>(l(),i(V,null,[w.value?(l(),i("div",Y,[o("img",{src:$.value,alt:"QR Code Preview",class:"max-h-[80vh] rounded-xl shadow-2xl border-4 border-white"},null,8,G),o("button",{onClick:e[0]||(e[0]=s=>w.value=!1),class:"absolute top-6 right-8 text-white text-3xl font-bold"}," âœ• ")])):c("",!0),o("div",J,[t.shop?(l(),i("div",K,[o("div",Z,[o("h1",ee,"Book at "+u(t.shop.name),1),_.value?(l(),i("div",te,u(_.value),1)):c("",!0),v.value?(l(),i("div",oe,u(v.value),1)):c("",!0),o("form",{onSubmit:P(U,["prevent"]),class:"space-y-4"},[p(o("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=s=>d(n).name=s),placeholder:"Your Name",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,d(n).name]]),p(o("input",{type:"email","onUpdate:modelValue":e[2]||(e[2]=s=>d(n).email=s),placeholder:"Email Address",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,d(n).email]]),p(o("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>d(n).size_of_the_car=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},[...e[15]||(e[15]=[o("option",{value:""},"Select Car Types",-1),o("option",null,"HatchBack",-1),o("option",null,"Sedan",-1),o("option",null,"MPV",-1),o("option",null,"SUV",-1),o("option",null,"Pickup",-1),o("option",null,"Van",-1),o("option",null,"Motorcycle",-1)])],512),[[L,d(n).size_of_the_car]]),p(o("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=s=>d(n).contact_no=s),placeholder:"09XXXXXXXXX",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:"",maxlength:"11",onInput:M},null,544),[[f,d(n).contact_no]]),p(o("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=s=>d(n).date_of_booking=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:"",min:W.value},null,8,se),[[f,d(n).date_of_booking]]),p(o("input",{type:"time","onUpdate:modelValue":e[6]||(e[6]=s=>d(n).time_of_booking=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:"",min:h.value},null,8,ne),[[f,d(n).time_of_booking]]),p(o("input",{type:"number","onUpdate:modelValue":e[7]||(e[7]=s=>d(n).slot_number=s),min:"1",max:"4",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,d(n).slot_number]]),o("div",null,[e[16]||(e[16]=o("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},"Services Offered",-1)),t.shop.services_offered?(l(),i("div",re,[t.shop.services_offered.match(/\.(jpg|jpeg|png|gif|webp)$/i)||t.shop.services_offered.startsWith("http")?(l(),i("div",ie,[o("img",{src:t.shop.services_offered.startsWith("http")?t.shop.services_offered:`/storage/${t.shop.services_offered}`,alt:"Services Offered",class:"h-24 w-24 object-contain rounded border cursor-pointer hover:scale-105 transition",onClick:e[8]||(e[8]=s=>m(t.shop.services_offered.startsWith("http")?t.shop.services_offered:`/storage/${t.shop.services_offered}`))},null,8,le)])):(l(),i("p",ae,u(t.shop.services_offered),1))])):(l(),i("div",de,"No services listed")),e[17]||(e[17]=o("label",{class:"block text-sm font-semibold text-gray-700 mt-3"},"Services Requested",-1)),p(o("textarea",{"onUpdate:modelValue":e[9]||(e[9]=s=>d(n).services_offered=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",placeholder:"Specify services you want",rows:"3"},null,512),[[f,d(n).services_offered]]),d(n).errors.services_offered?(l(),i("div",ue,u(d(n).errors.services_offered),1)):c("",!0)]),d(n).date_of_booking?(l(),i("div",ce,[o("h3",pe,"Taken Slots on "+u(Q.value)+" (View Only)",1),o("div",fe,[q.value.length?(l(),i("table",me,[e[19]||(e[19]=o("thead",{class:"bg-gray-50"},[o("tr",null,[o("th",null,"Time"),o("th",null,"Slot"),o("th",null,"Status")])],-1)),o("tbody",null,[(l(!0),i(V,null,z(q.value,s=>(l(),i("tr",{key:`${s.time}-${s.slot}-${s.id||0}`,class:"bg-red-50 border-l-4 border-red-400"},[o("td",ge,u(s.time),1),o("td",be,"#"+u(s.slot),1),e[18]||(e[18]=o("td",{class:"px-2 py-1 text-sm text-red-600 font-semibold"},"Taken",-1))]))),128))])])):(l(),i("p",he,"No taken slots yet."))])])):c("",!0),o("button",{type:"button",onClick:R,class:"w-full bg-gray-500 text-white py-2 rounded hover:bg-gray-600 transition"},"Return"),o("button",{type:"submit",class:"w-full bg-[#FF2D2D] text-white py-2 rounded hover:bg-red-700 transition",disabled:d(n).processing||B.value},"Pay Now",8,_e)],32)]),o("div",ve,[e[26]||(e[26]=o("h2",{class:"text-lg font-semibold text-[#002B5C mb-2"},"Shop Details",-1)),o("div",ye,[o("img",{src:X(t.shop),alt:"Car Wash Logo",class:"h-20 w-20 object-contain mb-2",onError:E},null,40,ke)]),o("p",null,[e[20]||(e[20]=o("span",{class:"font-semibold"},"Name:",-1)),k(" "+u(t.shop.name),1)]),o("p",null,[e[21]||(e[21]=o("span",{class:"font-semibold"},"Address:",-1)),k(" "+u(t.shop.address),1)]),o("p",null,[e[22]||(e[22]=o("span",{class:"font-semibold"},"District:",-1)),k(" "+u(t.shop.district||"Not specified"),1)]),o("p",null,[e[23]||(e[23]=o("span",{class:"font-semibold"},"Description:",-1)),k(" "+u(t.shop.description||"No description"),1)]),t.shop&&(t.shop.qr_code||t.shop.qr_code2||t.shop.qr_code3||t.shop.qr_code4||t.shop.qr_code5)?(l(),i("div",we,[e[25]||(e[25]=o("h3",{class:"text-sm font-semibold text-gray-700 mb-2"},"QR Codes",-1)),o("div",xe,[o("table",De,[e[24]||(e[24]=o("thead",{class:"bg-gray-50"},[o("tr",null,[o("th",{class:"px-3 py-2 text-center"},"QR Code 1"),o("th",{class:"px-3 py-2 text-center"},"QR Code 2"),o("th",{class:"px-3 py-2 text-center"},"QR Code 3"),o("th",{class:"px-3 py-2 text-center"},"QR Code 4"),o("th",{class:"px-3 py-2 text-center"},"QR Code 5")])],-1)),o("tbody",null,[o("tr",null,[o("td",Ce,[t.shop.qr_code?(l(),i("img",{key:0,src:t.shop.qr_code,alt:"QR Code 1",class:"h-12 w-12 object-cover rounded border mx-auto cursor-pointer hover:scale-105 transition",onClick:e[10]||(e[10]=s=>m(t.shop.qr_code))},null,8,Se)):c("",!0)]),o("td",$e,[t.shop.qr_code2?(l(),i("img",{key:0,src:t.shop.qr_code2,alt:"QR Code 2",class:"h-12 w-12 object-cover rounded border mx-auto cursor-pointer hover:scale-105 transition",onClick:e[11]||(e[11]=s=>m(t.shop.qr_code2))},null,8,qe)):c("",!0)]),o("td",Be,[t.shop.qr_code3?(l(),i("img",{key:0,src:t.shop.qr_code3,alt:"QR Code 3",class:"h-12 w-12 object-cover rounded border mx-auto cursor-pointer hover:scale-105 transition",onClick:e[12]||(e[12]=s=>m(t.shop.qr_code3))},null,8,Te)):c("",!0)]),o("td",Ve,[t.shop.qr_code4?(l(),i("img",{key:0,src:t.shop.qr_code4,alt:"QR Code 4",class:"h-12 w-12 object-cover rounded border mx-auto cursor-pointer hover:scale-105 transition",onClick:e[13]||(e[13]=s=>m(t.shop.qr_code4))},null,8,je)):c("",!0)]),o("td",Qe,[t.shop.qr_code5?(l(),i("img",{key:0,src:t.shop.qr_code5,alt:"QR Code 5",class:"h-12 w-12 object-cover rounded border mx-auto cursor-pointer hover:scale-105 transition",onClick:e[14]||(e[14]=s=>m(t.shop.qr_code5))},null,8,Re)):c("",!0)])])])])])])):c("",!0)])])):(l(),i("div",Ue,"Shop not found."))])],64))}});export{Xe as default};
