import{d as I,x as M,r as w,b as v,w as C,c as a,o as d,a as t,e as b,t as u,f as F,g as c,v as f,u as i,h as L,F as O,i as W,W as z,j as m,k as P}from"./app-D-WVRcB5.js";const A={class:"min-h-screen bg-gray-50 py-6 px-4 sm:px-6 flex justify-center"},Q={key:0,class:"w-full max-w-3xl bg-white rounded-2xl shadow-lg p-6 sm:p-8 grid grid-cols-1 md:grid-cols-2 gap-6"},R={class:"space-y-4"},H={class:"text-xl sm:text-2xl font-bold text-center text-[#002B5C] mb-4"},Y={key:0,class:"bg-red-100 text-red-800 p-2 rounded-lg text-sm"},G={key:1,class:"bg-red-100 text-red-800 p-2 rounded-lg text-sm"},J={key:0,class:"mt-4"},K={class:"text-sm font-semibold text-gray-700 mb-2"},Z={class:"overflow-x-auto"},ee={key:0,class:"min-w-full bg-white border rounded"},te={class:"px-2 py-1 text-sm"},oe={class:"px-2 py-1 text-sm"},se={key:1,class:"text-xs text-gray-500 italic"},ne=["disabled"],le={class:"space-y-4"},re={class:"flex justify-center"},ie=["src"],ae={key:0,class:"flex justify-center"},de=["src"],ue={key:1,class:"text-red-600 font-medium text-center mt-10"},pe=I({__name:"Booking",props:{shop:{},errors:{},bookings:{}},setup(T){const p=T,n=M({name:"",email:"",size_of_the_car:"",contact_no:"",time_of_booking:"",date_of_booking:"",slot_number:1}),g=w(""),_=w(""),k=w(p.bookings||[]),$=v(()=>n.date_of_booking?new Date(n.date_of_booking).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),x=v(()=>{if(!n.date_of_booking)return[];const o=n.date_of_booking,e=k.value.filter(r=>r.date_of_booking===o),s={};return e.forEach(r=>{const l=`${r.time_of_booking}-${r.slot_number}`;s[l]||(s[l]={id:r.id,time:r.time_of_booking,slot:r.slot_number,takenBy:""}),r.name?s[l].takenBy=s[l].takenBy&&s[l].takenBy!==r.name?"Multiple":r.name:s[l].takenBy||(s[l].takenBy="Unknown")}),Object.values(s).sort((r,l)=>new Date(`2000-01-01T${r.time}:00`).getTime()-new Date(`2000-01-01T${l.time}:00`).getTime())}),D=v(()=>{if(!n.date_of_booking||!n.time_of_booking||!n.slot_number)return!1;const o=new Date(`${n.date_of_booking}T${n.time_of_booking}:00`),e=new Date(o.getTime()+3*60*60*1e3);return k.value.some(s=>{const r=new Date(`${s.date_of_booking}T${s.time_of_booking}:00`),l=new Date(r.getTime()+3*60*60*1e3);return s.slot_number===n.slot_number&&r<e&&o<l})}),B=async o=>{var r;if(!o||!((r=p.shop)!=null&&r.id))return;const e=[new Date(o),new Date(o).setDate(new Date(o).getDate()-1),new Date(o).setDate(new Date(o).getDate()+1)].map(l=>new Date(l).toISOString().split("T")[0]),s=[];for(const l of[...new Set(e)])try{const y=await P.get(`/shops/${p.shop.id}/availability?date=${l}`);s.push(...y.data.bookings)}catch{}k.value=s.filter((l,y,j)=>y===j.findIndex(h=>h.date_of_booking===l.date_of_booking&&h.time_of_booking===l.time_of_booking&&h.slot_number===l.slot_number))},V=()=>z.visit(route("dashboard")),q=()=>{var o;if(g.value="",_.value="",!((o=p.shop)!=null&&o.id)){g.value="Invalid shop ID";return}if(D.value){_.value="This slot is already booked";return}n.post(`/customer/book/${p.shop.id}/payment`)},U=window.location.origin;function N(o){var e;return(e=o.logo)!=null&&e.startsWith("http")?o.logo:`/storage/${o.logo}`||"/images/default-carwash.png"}function E(o){var e;return(e=o.qr_code)!=null&&e.startsWith("http")?o.qr_code:`/storage/${o.qr_code}`||""}function S(o){const e=o.target;e&&(e.src=`${U}/images/default-carwash.png`)}C(()=>n.date_of_booking,B),C(()=>p.shop,o=>{o!=null&&o.id&&n.date_of_booking&&B(n.date_of_booking)});function X(o){const e=o.target;e.value=e.value.replace(/\D/g,"").slice(0,11),n.contact_no=e.value}return(o,e)=>(d(),a("div",A,[o.shop?(d(),a("div",Q,[t("div",R,[t("h1",H,"Book at "+u(o.shop.name),1),g.value?(d(),a("div",Y,u(g.value),1)):b("",!0),_.value?(d(),a("div",G,u(_.value),1)):b("",!0),t("form",{onSubmit:F(q,["prevent"]),class:"space-y-4"},[c(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>i(n).name=s),placeholder:"Your Name",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,i(n).name]]),c(t("input",{type:"email","onUpdate:modelValue":e[1]||(e[1]=s=>i(n).email=s),placeholder:"Email Address",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,i(n).email]]),c(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>i(n).size_of_the_car=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},[...e[7]||(e[7]=[t("option",{value:""},"Select Car Types",-1),t("option",null,"HatchBack",-1),t("option",null,"Sedan",-1),t("option",null,"MPV",-1),t("option",null,"SUV",-1),t("option",null,"Pickup",-1),t("option",null,"Van",-1),t("option",null,"Motorcycle",-1)])],512),[[L,i(n).size_of_the_car]]),c(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=s=>i(n).contact_no=s),placeholder:"09XXXXXXXXX",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:"",maxlength:"11",onInput:X},null,544),[[f,i(n).contact_no]]),c(t("input",{type:"time","onUpdate:modelValue":e[4]||(e[4]=s=>i(n).time_of_booking=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,i(n).time_of_booking]]),c(t("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=s=>i(n).date_of_booking=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,i(n).date_of_booking]]),c(t("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=s=>i(n).slot_number=s),min:"1",max:"4",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,i(n).slot_number]]),i(n).date_of_booking?(d(),a("div",J,[t("h3",K,"Taken Slots on "+u($.value)+" (View Only)",1),t("div",Z,[x.value.length?(d(),a("table",ee,[e[9]||(e[9]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",null,"Time"),t("th",null,"Slot"),t("th",null,"Status")])],-1)),t("tbody",null,[(d(!0),a(O,null,W(x.value,s=>(d(),a("tr",{key:`${s.time}-${s.slot}-${s.id||0}`,class:"bg-red-50 border-l-4 border-red-400"},[t("td",te,u(s.time),1),t("td",oe,"#"+u(s.slot),1),e[8]||(e[8]=t("td",{class:"px-2 py-1 text-sm text-red-600 font-semibold"},"Taken",-1))]))),128))])])):(d(),a("p",se,"No taken slots yet."))])])):b("",!0),t("button",{type:"button",onClick:V,class:"w-full bg-gray-500 text-white py-2 rounded hover:bg-gray-600 transition"},"Return"),t("button",{type:"submit",class:"w-full bg-[#FF2D2D] text-white py-2 rounded hover:bg-red-700 transition",disabled:i(n).processing||D.value},"Pay Now",8,ne)],32)]),t("div",le,[e[15]||(e[15]=t("h2",{class:"text-lg font-semibold text-[#002B5C] mb-2"},"Shop Details",-1)),t("div",re,[t("img",{src:N(o.shop),alt:"Car Wash Logo",class:"h-20 w-20 object-contain mb-2",onError:S},null,40,ie)]),t("p",null,[e[10]||(e[10]=t("span",{class:"font-semibold"},"Name:",-1)),m(" "+u(o.shop.name),1)]),t("p",null,[e[11]||(e[11]=t("span",{class:"font-semibold"},"Address:",-1)),m(" "+u(o.shop.address),1)]),t("p",null,[e[12]||(e[12]=t("span",{class:"font-semibold"},"District:",-1)),m(" "+u(o.shop.district||"Not specified"),1)]),t("p",null,[e[13]||(e[13]=t("span",{class:"font-semibold"},"Description:",-1)),m(" "+u(o.shop.description||"No description"),1)]),t("p",null,[e[14]||(e[14]=t("span",{class:"font-semibold"},"Services Offered:",-1)),m(" "+u(o.shop.services_offered||"No services listed"),1)]),o.shop.qr_code?(d(),a("div",ae,[t("img",{src:E(o.shop),alt:"QR Code",class:"h-20 w-20 object-contain",onError:S},null,40,de)])):b("",!0)])])):(d(),a("div",ue,"Shop not found."))]))}});export{pe as default};
