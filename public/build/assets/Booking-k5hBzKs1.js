import{d as I,x as M,r as h,b as w,w as C,c as a,o as d,a as t,e as m,t as u,f as F,g as c,v as f,u as r,h as L,i as g,F as O,j as W,W as z,k as P}from"./app-ZlIocKjQ.js";const R={class:"min-h-screen bg-gray-50 py-6 px-4 sm:px-6 flex justify-center"},A={key:0,class:"w-full max-w-3xl bg-white rounded-2xl shadow-lg p-6 sm:p-8 grid grid-cols-1 md:grid-cols-2 gap-6"},Q={class:"space-y-4"},H={class:"text-xl sm:text-2xl font-bold text-center text-[#002B5C] mb-4"},Y={key:0,class:"bg-red-100 text-red-800 p-2 rounded-lg text-sm"},G={key:1,class:"bg-red-100 text-red-800 p-2 rounded-lg text-sm"},J={key:0,class:"text-red-600 text-sm mt-1"},K={key:0,class:"mt-4"},Z={class:"text-sm font-semibold text-gray-700 mb-2"},ee={class:"overflow-x-auto"},te={key:0,class:"min-w-full bg-white border rounded"},oe={class:"px-2 py-1 text-sm"},se={class:"px-2 py-1 text-sm"},ne={key:1,class:"text-xs text-gray-500 italic"},re=["disabled"],le={class:"space-y-4"},ie={class:"flex justify-center"},ae=["src"],de={key:0,class:"flex justify-center"},ue=["src"],ce={key:1,class:"text-red-600 font-medium text-center mt-10"},pe=I({__name:"Booking",props:{shop:{},errors:{},bookings:{}},setup(T){const p=T,n=M({name:"",email:"",size_of_the_car:"",contact_no:"",time_of_booking:"",date_of_booking:"",slot_number:1,services_offered:""}),b=h(""),_=h(""),y=h(p.bookings||[]),$=w(()=>n.date_of_booking?new Date(n.date_of_booking).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),x=w(()=>{if(!n.date_of_booking)return[];const o=n.date_of_booking,e=y.value.filter(i=>i.date_of_booking===o),s={};return e.forEach(i=>{const l=`${i.time_of_booking}-${i.slot_number}`;s[l]||(s[l]={id:i.id,time:i.time_of_booking,slot:i.slot_number,takenBy:""}),i.name?s[l].takenBy=s[l].takenBy&&s[l].takenBy!==i.name?"Multiple":i.name:s[l].takenBy||(s[l].takenBy="Unknown")}),Object.values(s).sort((i,l)=>new Date(`2000-01-01T${i.time}:00`).getTime()-new Date(`2000-01-01T${l.time}:00`).getTime())}),D=w(()=>{if(!n.date_of_booking||!n.time_of_booking||!n.slot_number)return!1;const o=new Date(`${n.date_of_booking}T${n.time_of_booking}:00`),e=new Date(o.getTime()+3*60*60*1e3);return y.value.some(s=>{const i=new Date(`${s.date_of_booking}T${s.time_of_booking}:00`),l=new Date(i.getTime()+3*60*60*1e3);return s.slot_number===n.slot_number&&i<e&&o<l})}),B=async o=>{var i;if(!o||!((i=p.shop)!=null&&i.id))return;const e=[new Date(o),new Date(o).setDate(new Date(o).getDate()-1),new Date(o).setDate(new Date(o).getDate()+1)].map(l=>new Date(l).toISOString().split("T")[0]),s=[];for(const l of[...new Set(e)])try{const k=await P.get(`/shops/${p.shop.id}/availability?date=${l}`);s.push(...k.data.bookings)}catch{}y.value=s.filter((l,k,j)=>k===j.findIndex(v=>v.date_of_booking===l.date_of_booking&&v.time_of_booking===l.time_of_booking&&v.slot_number===l.slot_number))},V=()=>z.visit(route("dashboard")),q=()=>{var o;if(b.value="",_.value="",!((o=p.shop)!=null&&o.id)){b.value="Invalid shop ID";return}if(D.value){_.value="This slot is already booked";return}n.post(`/customer/book/${p.shop.id}/payment`)},U=window.location.origin;function N(o){var e;return(e=o.logo)!=null&&e.startsWith("http")?o.logo:`/storage/${o.logo}`||"/images/default-carwash.png"}function E(o){var e;return(e=o.qr_code)!=null&&e.startsWith("http")?o.qr_code:`/storage/${o.qr_code}`||""}function S(o){const e=o.target;e&&(e.src=`${U}/images/default-carwash.png`)}C(()=>n.date_of_booking,B),C(()=>p.shop,o=>{o!=null&&o.id&&n.date_of_booking&&B(n.date_of_booking)});function X(o){const e=o.target;e.value=e.value.replace(/\D/g,"").slice(0,11),n.contact_no=e.value}return(o,e)=>(d(),a("div",R,[o.shop?(d(),a("div",A,[t("div",Q,[t("h1",H,"Book at "+u(o.shop.name),1),b.value?(d(),a("div",Y,u(b.value),1)):m("",!0),_.value?(d(),a("div",G,u(_.value),1)):m("",!0),t("form",{onSubmit:F(q,["prevent"]),class:"space-y-4"},[c(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>r(n).name=s),placeholder:"Your Name",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,r(n).name]]),c(t("input",{type:"email","onUpdate:modelValue":e[1]||(e[1]=s=>r(n).email=s),placeholder:"Email Address",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,r(n).email]]),c(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>r(n).size_of_the_car=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},[...e[8]||(e[8]=[t("option",{value:""},"Select Car Types",-1),t("option",null,"HatchBack",-1),t("option",null,"Sedan",-1),t("option",null,"MPV",-1),t("option",null,"SUV",-1),t("option",null,"Pickup",-1),t("option",null,"Van",-1),t("option",null,"Motorcycle",-1)])],512),[[L,r(n).size_of_the_car]]),c(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=s=>r(n).contact_no=s),placeholder:"09XXXXXXXXX",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:"",maxlength:"11",onInput:X},null,544),[[f,r(n).contact_no]]),c(t("input",{type:"time","onUpdate:modelValue":e[4]||(e[4]=s=>r(n).time_of_booking=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,r(n).time_of_booking]]),c(t("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=s=>r(n).date_of_booking=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,r(n).date_of_booking]]),c(t("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=s=>r(n).slot_number=s),min:"1",max:"4",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,r(n).slot_number]]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-semibold text-gray-700"},"Services Requested",-1)),t("p",null,[e[9]||(e[9]=t("span",{class:"font-semibold"},"Services Offered:",-1)),g(" "+u(o.shop.services_offered||"No services listed"),1)]),c(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=s=>r(n).services_offered=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",placeholder:"Specify services you want",rows:"3"},null,512),[[f,r(n).services_offered]]),r(n).errors.services_offered?(d(),a("div",J,u(r(n).errors.services_offered),1)):m("",!0)]),r(n).date_of_booking?(d(),a("div",K,[t("h3",Z,"Taken Slots on "+u($.value)+" (View Only)",1),t("div",ee,[x.value.length?(d(),a("table",te,[e[12]||(e[12]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",null,"Time"),t("th",null,"Slot"),t("th",null,"Status")])],-1)),t("tbody",null,[(d(!0),a(O,null,W(x.value,s=>(d(),a("tr",{key:`${s.time}-${s.slot}-${s.id||0}`,class:"bg-red-50 border-l-4 border-red-400"},[t("td",oe,u(s.time),1),t("td",se,"#"+u(s.slot),1),e[11]||(e[11]=t("td",{class:"px-2 py-1 text-sm text-red-600 font-semibold"},"Taken",-1))]))),128))])])):(d(),a("p",ne,"No taken slots yet."))])])):m("",!0),t("button",{type:"button",onClick:V,class:"w-full bg-gray-500 text-white py-2 rounded hover:bg-gray-600 transition"},"Return"),t("button",{type:"submit",class:"w-full bg-[#FF2D2D] text-white py-2 rounded hover:bg-red-700 transition",disabled:r(n).processing||D.value},"Pay Now",8,re)],32)]),t("div",le,[e[17]||(e[17]=t("h2",{class:"text-lg font-semibold text-[#002B5C] mb-2"},"Shop Details",-1)),t("div",ie,[t("img",{src:N(o.shop),alt:"Car Wash Logo",class:"h-20 w-20 object-contain mb-2",onError:S},null,40,ae)]),t("p",null,[e[13]||(e[13]=t("span",{class:"font-semibold"},"Name:",-1)),g(" "+u(o.shop.name),1)]),t("p",null,[e[14]||(e[14]=t("span",{class:"font-semibold"},"Address:",-1)),g(" "+u(o.shop.address),1)]),t("p",null,[e[15]||(e[15]=t("span",{class:"font-semibold"},"District:",-1)),g(" "+u(o.shop.district||"Not specified"),1)]),t("p",null,[e[16]||(e[16]=t("span",{class:"font-semibold"},"Description:",-1)),g(" "+u(o.shop.description||"No description"),1)]),o.shop.qr_code?(d(),a("div",de,[t("img",{src:E(o.shop),alt:"QR Code",class:"h-20 w-20 object-contain",onError:S},null,40,ue)])):m("",!0)])])):(d(),a("div",ce,"Shop not found."))]))}});export{pe as default};
