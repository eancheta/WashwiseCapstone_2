import{d as O,x as j,r as h,b as w,w as T,c as i,o as l,a as t,e as m,t as d,f as I,g as p,v as _,u as n,h as z,i as A,F,j as W,k as L,W as Q}from"./app-DhSMx4Bu.js";const R={class:"min-h-screen bg-gray-50 py-10 px-4 flex justify-center"},H={key:0,class:"w-full max-w-4xl bg-white rounded-2xl shadow-lg p-8 grid grid-cols-1 md:grid-cols-2 gap-8"},Y={class:"space-y-5"},G={class:"text-2xl font-bold text-center text-[#002B5C] mb-6"},J={key:0,class:"bg-green-100 text-green-800 p-3 rounded-lg mb-4 text-sm"},K={key:1,class:"bg-red-100 text-red-800 p-3 rounded-lg mb-4 text-sm"},X={key:2,class:"bg-red-100 text-red-800 p-3 rounded-lg mb-4 text-sm"},Z={key:3,class:"bg-red-100 text-red-800 p-3 rounded-lg mb-4 text-sm"},ee={key:0,class:"text-red-600 text-sm mt-1"},te={key:0,class:"text-red-600 text-sm mt-1"},oe={key:0,class:"text-red-600 text-sm mt-1"},se={key:0,class:"text-red-600 text-sm mt-1"},re={key:0,class:"text-red-600 text-sm mt-1"},ne={key:0,class:"text-red-600 text-sm mt-1"},ie={key:0,class:"text-red-600 text-sm mt-1"},le={key:0,class:"mt-6"},ae={class:"text-sm font-semibold text-gray-700 mb-2"},de={class:"overflow-x-auto"},ue={key:0,class:"min-w-full bg-white border border-gray-200 rounded-lg"},me={class:"divide-y divide-gray-200"},ge={class:"px-4 py-2 text-sm text-gray-900 font-medium"},ce={class:"px-4 py-2 text-sm text-gray-900"},fe={key:1,class:"text-sm text-gray-500 italic"},pe=["disabled"],be={key:0},ye={key:1},_e={class:"space-y-5"},xe={class:"flex justify-center"},ke=["src"],ve={class:"text-gray-900"},he={class:"text-gray-900"},we={class:"text-gray-900"},Be={class:"text-gray-900"},Se={class:"text-gray-900"},De=["src"],$e={key:1,class:"text-red-600 font-medium"},Ce=O({__name:"Booking",props:{shop:{},errors:{},bookings:{}},setup(C){const b=C,o=j({name:"",email:"",size_of_the_car:"",contact_no:"",time_of_booking:"",date_of_booking:"",slot_number:1}),x=h(""),y=h(""),k=h(b.bookings||[]),V=w(()=>o.date_of_booking?new Date(o.date_of_booking).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),B=w(()=>{if(!o.date_of_booking)return[];const s=o.date_of_booking,e=k.value.filter(r=>r.date_of_booking===s),a={};e.forEach(r=>{const u=`${r.time_of_booking}-${r.slot_number}`;a[u]||(a[u]={id:r.id,time:r.time_of_booking,slot:r.slot_number,takenBy:""}),r.name?a[u].takenBy===""?a[u].takenBy=r.name:a[u].takenBy!==r.name&&(a[u].takenBy="Multiple"):a[u].takenBy===""&&(a[u].takenBy="Unknown")});const g=Object.values(a);return g.sort((r,u)=>{const c=new Date(`2000-01-01T${r.time}:00`).getTime(),f=new Date(`2000-01-01T${u.time}:00`).getTime();return c-f}),g}),S=w(()=>{if(!o.date_of_booking||!o.time_of_booking||!o.slot_number)return!1;const s=new Date(`${o.date_of_booking}T${o.time_of_booking}:00`),e=new Date(s.getTime()+3*60*60*1e3);return k.value.some(a=>{const g=new Date(`${a.date_of_booking}T${a.time_of_booking}:00`),r=new Date(g.getTime()+3*60*60*1e3);return a.slot_number===o.slot_number&&g<e&&s<r})}),D=async s=>{var u;if(!s||!((u=b.shop)!=null&&u.id))return;const e=[],a=new Date(s);e.push(a.toISOString().split("T")[0]),e.push(new Date(a.getTime()-24*60*60*1e3).toISOString().split("T")[0]),e.push(new Date(a.getTime()+24*60*60*1e3).toISOString().split("T")[0]);const g=[];for(const c of[...new Set(e)])try{const f=await L.get(`/shops/${b.shop.id}/availability?date=${c}`);g.push(...f.data.bookings)}catch(f){console.warn(`No bookings found for ${c}:`,f)}const r=g.filter((c,f,M)=>f===M.findIndex(v=>v.date_of_booking===c.date_of_booking&&v.time_of_booking===c.time_of_booking&&v.slot_number===c.slot_number));k.value=r},N=()=>{o.isDirty&&console.warn("Unsaved changes detected. Navigating away without confirmation."),Q.visit(route("dashboard"))},U=()=>{var s;if(x.value="",y.value="",!((s=b.shop)!=null&&s.id)){x.value="Invalid shop ID. Please select a valid shop.";return}if(S.value){y.value="This slot is already booked within the next 3 hours. Please choose a different time or slot.";return}o.post(`/customer/book/${b.shop.id}/payment`,{onSuccess:()=>console.log("Booking submitted successfully, redirected to payment"),onError:e=>{console.error("Booking submission errors:",e),Object.keys(e).length>0?(o.errors={...o.errors,...e},e.time_of_booking&&(y.value=e.time_of_booking)):y.value="An unexpected error occurred. Please try again."}})},q=window.location.origin;function E(s){return s.logo?s.logo.startsWith("http")?s.logo:`/storage/${s.logo}`:"/images/default-carwash.png"}function P(s){return s.qr_code?s.qr_code.startsWith("http")?s.qr_code:`/storage/${s.qr_code}`:""}function $(s){const e=s.target;e&&(e.src=`${q}/images/default-carwash.png`)}return T(()=>o.date_of_booking,s=>{s&&D(s)}),T(()=>b.shop,s=>{console.log("Shop updated:",s),s!=null&&s.id&&o.date_of_booking&&D(o.date_of_booking)}),(s,e)=>{var a,g;return l(),i("div",R,[s.shop?(l(),i("div",H,[t("div",Y,[t("h1",G," Book at "+d(s.shop.name),1),(a=s.$page.props.flash)!=null&&a.success?(l(),i("div",J,d(s.$page.props.flash.success),1)):m("",!0),(g=s.$page.props.flash)!=null&&g.error?(l(),i("div",K,d(s.$page.props.flash.error),1)):m("",!0),x.value?(l(),i("div",X,d(x.value),1)):m("",!0),y.value?(l(),i("div",Z,d(y.value),1)):m("",!0),t("form",{onSubmit:I(U,["prevent"]),class:"space-y-5"},[t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-semibold text-gray-700"},"Your Name",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=r=>n(o).name=r),class:"w-full mt-1 p-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-[#002B5C] focus:outline-none",required:""},null,512),[[_,n(o).name]]),n(o).errors.name?(l(),i("div",ee,d(n(o).errors.name),1)):m("",!0)]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-semibold text-gray-700"},"Email Address",-1)),p(t("input",{type:"email","onUpdate:modelValue":e[1]||(e[1]=r=>n(o).email=r),class:"w-full mt-1 p-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-[#002B5C] focus:outline-none",required:""},null,512),[[_,n(o).email]]),n(o).errors.email?(l(),i("div",te,d(n(o).errors.email),1)):m("",!0)]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-semibold text-gray-700"},"Size of the Car",-1)),p(t("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>n(o).size_of_the_car=r),class:"w-full mt-1 p-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-[#002B5C] focus:outline-none",required:""},[...e[9]||(e[9]=[A('<option value="">Select</option><option value="HatchBack">HatchBack</option><option value="Sedan">Sedan</option><option value="MPV">MPV</option><option value="SUV">SUV</option><option value="Pickup">Pickup</option><option value="Van">Van</option><option value="Motorcycle">Motorcycle</option>',8)])],512),[[z,n(o).size_of_the_car]]),n(o).errors.size_of_the_car?(l(),i("div",oe,d(n(o).errors.size_of_the_car),1)):m("",!0)]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-semibold text-gray-700"},"Contact Number",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=r=>n(o).contact_no=r),class:"w-full mt-1 p-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-[#002B5C] focus:outline-none",required:""},null,512),[[_,n(o).contact_no]]),n(o).errors.contact_no?(l(),i("div",se,d(n(o).errors.contact_no),1)):m("",!0)]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-semibold text-gray-700"},"Time of Booking",-1)),p(t("input",{type:"time","onUpdate:modelValue":e[4]||(e[4]=r=>n(o).time_of_booking=r),class:"w-full mt-1 p-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-[#002B5C] focus:outline-none",required:""},null,512),[[_,n(o).time_of_booking]]),n(o).errors.time_of_booking?(l(),i("div",re,d(n(o).errors.time_of_booking),1)):m("",!0)]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-semibold text-gray-700"},"Date of Booking",-1)),p(t("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=r=>n(o).date_of_booking=r),class:"w-full mt-1 p-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-[#002B5C] focus:outline-none",required:""},null,512),[[_,n(o).date_of_booking]]),n(o).errors.date_of_booking?(l(),i("div",ne,d(n(o).errors.date_of_booking),1)):m("",!0)]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-semibold text-gray-700"},"Slot Number",-1)),p(t("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=r=>n(o).slot_number=r),min:"1",max:"4",class:"w-full mt-1 p-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-[#002B5C] focus:outline-none",required:""},null,512),[[_,n(o).slot_number]]),n(o).errors.slot_number?(l(),i("div",ie,d(n(o).errors.slot_number),1)):m("",!0)]),n(o).date_of_booking?(l(),i("div",le,[t("h3",ae,"Taken Slots on "+d(V.value)+" (View Only)",1),t("div",de,[B.value.length>0?(l(),i("table",ue,[e[16]||(e[16]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Time"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Slot"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Status")])],-1)),t("tbody",me,[(l(!0),i(F,null,W(B.value,r=>(l(),i("tr",{key:`${r.time}-${r.slot}-${r.id||0}`,class:"bg-red-50 border-l-4 border-red-400 hover:bg-red-100"},[t("td",ge,d(r.time),1),t("td",ce,"#"+d(r.slot),1),e[15]||(e[15]=t("td",{class:"px-4 py-2 text-sm"},[t("span",{class:"text-red-600 font-semibold"},"Taken")],-1))]))),128))])])):(l(),i("p",fe,"No taken slots on this date yet."))]),e[17]||(e[17]=t("p",{class:"text-xs text-gray-500 mt-2"},"Bookings are sorted by time. Each lasts 3 hours; avoid overlaps.",-1))])):m("",!0),t("button",{type:"button",onClick:N,class:"w-full bg-gray-500 text-white py-2 rounded-lg font-semibold hover:bg-gray-600 transition"}," Return to Dashboard "),t("button",{type:"submit",class:"w-full bg-[#FF2D2D] text-white py-2 rounded-lg font-semibold hover:bg-red-700 transition disabled:opacity-50",disabled:n(o).processing||S.value},[n(o).processing?(l(),i("span",be,"Processing...")):(l(),i("span",ye,"Pay Now"))],8,pe)],32)]),t("div",_e,[e[24]||(e[24]=t("h2",{class:"text-xl font-semibold text-[#002B5C] mb-4"},"Shop Details",-1)),t("div",xe,[t("img",{src:E(s.shop),alt:"Car Wash Logo",class:"h-20 w-20 object-contain mb-4",onError:$},null,40,ke)]),t("div",null,[e[18]||(e[18]=t("h3",{class:"text-sm font-semibold text-gray-700"},"Name",-1)),t("p",ve,d(s.shop.name),1)]),t("div",null,[e[19]||(e[19]=t("h3",{class:"text-sm font-semibold text-gray-700"},"Address",-1)),t("p",he,d(s.shop.address),1)]),t("div",null,[e[20]||(e[20]=t("h3",{class:"text-sm font-semibold text-gray-700"},"District",-1)),t("p",we,d(s.shop.district||"Not specified"),1)]),t("div",null,[e[21]||(e[21]=t("h3",{class:"text-sm font-semibold text-gray-700"},"Description",-1)),t("p",Be,d(s.shop.description||"No description available"),1)]),t("div",null,[e[22]||(e[22]=t("h3",{class:"text-sm font-semibold text-gray-700"},"Services Offered",-1)),t("p",Se,d(s.shop.services_offered||"No services listed"),1)]),t("div",null,[e[23]||(e[23]=t("h3",{class:"text-sm font-semibold text-gray-700"},"QR Code",-1)),t("img",{src:P(s.shop),alt:"QR Code",class:"h-20 w-20 object-contain mb-4",onError:$},null,40,De)])])])):(l(),i("div",$e,"Shop not found. Please select a valid shop."))])}}});export{Ce as default};
