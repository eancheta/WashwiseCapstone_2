import{d as I,x as L,r as w,b as p,w as $,c as a,o as d,a as o,e as g,t as u,f as O,g as c,v as f,u as i,h as W,i as _,F as z,j as P,W as R,k as A}from"./app-CP3_bvQb.js";const H={class:"min-h-screen bg-gray-50 py-6 px-4 sm:px-6 flex justify-center"},Q={key:0,class:"w-full max-w-3xl bg-white rounded-2xl shadow-lg p-6 sm:p-8 grid grid-cols-1 md:grid-cols-2 gap-6"},Y={class:"space-y-4"},G={class:"text-xl sm:text-2xl font-bold text-center text-[#002B5C] mb-4"},J={key:0,class:"bg-red-100 text-red-800 p-2 rounded-lg text-sm"},K={key:1,class:"bg-red-100 text-red-800 p-2 rounded-lg text-sm"},Z=["min"],ee=["min"],te={key:0,class:"text-red-600 text-sm mt-1"},oe={key:0,class:"mt-4"},se={class:"text-sm font-semibold text-gray-700 mb-2"},ne={class:"overflow-x-auto"},re={key:0,class:"min-w-full bg-white border rounded"},ie={class:"px-2 py-1 text-sm"},le={class:"px-2 py-1 text-sm"},ae={key:1,class:"text-xs text-gray-500 italic"},de=["disabled"],ue={class:"space-y-4"},ce={class:"flex justify-center"},fe=["src"],me={key:0,class:"flex justify-center"},pe=["src"],ge={key:1,class:"text-red-600 font-medium text-center mt-10"},be=I({__name:"Booking",props:{shop:{},errors:{},bookings:{}},setup(C){const m=C,n=L({name:"",email:"",size_of_the_car:"",contact_no:"",time_of_booking:"",date_of_booking:"",slot_number:1,services_offered:""}),b=w(""),y=w(""),k=w(m.bookings||[]),T=p(()=>n.date_of_booking?new Date(n.date_of_booking).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),x=p(()=>{if(!n.date_of_booking)return[];const t=n.date_of_booking,e=k.value.filter(r=>r.date_of_booking===t),s={};return e.forEach(r=>{const l=`${r.time_of_booking}-${r.slot_number}`;s[l]||(s[l]={id:r.id,time:r.time_of_booking,slot:r.slot_number,takenBy:""}),r.name?s[l].takenBy=s[l].takenBy&&s[l].takenBy!==r.name?"Multiple":r.name:s[l].takenBy||(s[l].takenBy="Unknown")}),Object.values(s).sort((r,l)=>new Date(`2000-01-01T${r.time}:00`).getTime()-new Date(`2000-01-01T${l.time}:00`).getTime())}),D=p(()=>{if(!n.date_of_booking||!n.time_of_booking||!n.slot_number)return!1;const t=new Date(`${n.date_of_booking}T${n.time_of_booking}:00`),e=new Date(t.getTime()+3*60*60*1e3);return k.value.some(s=>{const r=new Date(`${s.date_of_booking}T${s.time_of_booking}:00`),l=new Date(r.getTime()+3*60*60*1e3);return s.slot_number===n.slot_number&&r<e&&t<l})}),S=async t=>{var r;if(!t||!((r=m.shop)!=null&&r.id))return;const e=[new Date(t),new Date(t).setDate(new Date(t).getDate()-1),new Date(t).setDate(new Date(t).getDate()+1)].map(l=>new Date(l).toISOString().split("T")[0]),s=[];for(const l of[...new Set(e)])try{const v=await A.get(`/shops/${m.shop.id}/availability?date=${l}`);s.push(...v.data.bookings)}catch{}k.value=s.filter((l,v,F)=>v===F.findIndex(h=>h.date_of_booking===l.date_of_booking&&h.time_of_booking===l.time_of_booking&&h.slot_number===l.slot_number))},V=()=>R.visit(route("dashboard")),q=()=>{var t;if(b.value="",y.value="",!((t=m.shop)!=null&&t.id)){b.value="Invalid shop ID";return}if(D.value){y.value="This slot is already booked";return}n.post(`/customer/book/${m.shop.id}/payment`)},U=window.location.origin;function N(t){var e;return(e=t.logo)!=null&&e.startsWith("http")?t.logo:`/storage/${t.logo}`||"/images/default-carwash.png"}function E(t){var e;return(e=t.qr_code)!=null&&e.startsWith("http")?t.qr_code:`/storage/${t.qr_code}`||""}function B(t){const e=t.target;e&&(e.src=`${U}/images/default-carwash.png`)}$(()=>n.date_of_booking,S),$(()=>m.shop,t=>{t!=null&&t.id&&n.date_of_booking&&S(n.date_of_booking)});function X(t){const e=t.target;e.value=e.value.replace(/\D/g,"").slice(0,11),n.contact_no=e.value}const M=p(()=>{const t=new Date,e=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${s}-${r}`}),j=p(()=>{if(!n.date_of_booking)return"";const t=new Date,e=new Date(n.date_of_booking);if(t.toDateString()===e.toDateString()){const s=t.getHours().toString().padStart(2,"0"),r=t.getMinutes().toString().padStart(2,"0");return`${s}:${r}`}return"00:00"});return(t,e)=>(d(),a("div",H,[t.shop?(d(),a("div",Q,[o("div",Y,[o("h1",G,"Book at "+u(t.shop.name),1),b.value?(d(),a("div",J,u(b.value),1)):g("",!0),y.value?(d(),a("div",K,u(y.value),1)):g("",!0),o("form",{onSubmit:O(q,["prevent"]),class:"space-y-4"},[c(o("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>i(n).name=s),placeholder:"Your Name",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,i(n).name]]),c(o("input",{type:"email","onUpdate:modelValue":e[1]||(e[1]=s=>i(n).email=s),placeholder:"Email Address",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,i(n).email]]),c(o("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>i(n).size_of_the_car=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},[...e[8]||(e[8]=[o("option",{value:""},"Select Car Types",-1),o("option",null,"HatchBack",-1),o("option",null,"Sedan",-1),o("option",null,"MPV",-1),o("option",null,"SUV",-1),o("option",null,"Pickup",-1),o("option",null,"Van",-1),o("option",null,"Motorcycle",-1)])],512),[[W,i(n).size_of_the_car]]),c(o("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=s=>i(n).contact_no=s),placeholder:"09XXXXXXXXX",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:"",maxlength:"11",onInput:X},null,544),[[f,i(n).contact_no]]),c(o("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=s=>i(n).date_of_booking=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:"",min:M.value},null,8,Z),[[f,i(n).date_of_booking]]),c(o("input",{type:"time","onUpdate:modelValue":e[5]||(e[5]=s=>i(n).time_of_booking=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:"",min:j.value},null,8,ee),[[f,i(n).time_of_booking]]),c(o("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=s=>i(n).slot_number=s),min:"1",max:"4",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,i(n).slot_number]]),o("div",null,[e[10]||(e[10]=o("label",{class:"block text-sm font-semibold text-gray-700"},"Services Requested",-1)),o("p",null,[e[9]||(e[9]=o("span",{class:"font-semibold"},"Services Offered:",-1)),_(" "+u(t.shop.services_offered||"No services listed"),1)]),c(o("textarea",{"onUpdate:modelValue":e[7]||(e[7]=s=>i(n).services_offered=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",placeholder:"Specify services you want",rows:"3"},null,512),[[f,i(n).services_offered]]),i(n).errors.services_offered?(d(),a("div",te,u(i(n).errors.services_offered),1)):g("",!0)]),i(n).date_of_booking?(d(),a("div",oe,[o("h3",se,"Taken Slots on "+u(T.value)+" (View Only)",1),o("div",ne,[x.value.length?(d(),a("table",re,[e[12]||(e[12]=o("thead",{class:"bg-gray-50"},[o("tr",null,[o("th",null,"Time"),o("th",null,"Slot"),o("th",null,"Status")])],-1)),o("tbody",null,[(d(!0),a(z,null,P(x.value,s=>(d(),a("tr",{key:`${s.time}-${s.slot}-${s.id||0}`,class:"bg-red-50 border-l-4 border-red-400"},[o("td",ie,u(s.time),1),o("td",le,"#"+u(s.slot),1),e[11]||(e[11]=o("td",{class:"px-2 py-1 text-sm text-red-600 font-semibold"},"Taken",-1))]))),128))])])):(d(),a("p",ae,"No taken slots yet."))])])):g("",!0),o("button",{type:"button",onClick:V,class:"w-full bg-gray-500 text-white py-2 rounded hover:bg-gray-600 transition"},"Return"),o("button",{type:"submit",class:"w-full bg-[#FF2D2D] text-white py-2 rounded hover:bg-red-700 transition",disabled:i(n).processing||D.value},"Pay Now",8,de)],32)]),o("div",ue,[e[17]||(e[17]=o("h2",{class:"text-lg font-semibold text-[#002B5C mb-2"},"Shop Details",-1)),o("div",ce,[o("img",{src:N(t.shop),alt:"Car Wash Logo",class:"h-20 w-20 object-contain mb-2",onError:B},null,40,fe)]),o("p",null,[e[13]||(e[13]=o("span",{class:"font-semibold"},"Name:",-1)),_(" "+u(t.shop.name),1)]),o("p",null,[e[14]||(e[14]=o("span",{class:"font-semibold"},"Address:",-1)),_(" "+u(t.shop.address),1)]),o("p",null,[e[15]||(e[15]=o("span",{class:"font-semibold"},"District:",-1)),_(" "+u(t.shop.district||"Not specified"),1)]),o("p",null,[e[16]||(e[16]=o("span",{class:"font-semibold"},"Description:",-1)),_(" "+u(t.shop.description||"No description"),1)]),t.shop.qr_code?(d(),a("div",me,[o("img",{src:E(t.shop),alt:"QR Code",class:"h-20 w-20 object-contain",onError:B},null,40,pe)])):g("",!0)])])):(d(),a("div",ge,"Shop not found."))]))}});export{be as default};
