import{d as j,x as I,r as w,b as v,w as $,c as a,o as d,a as t,e as _,t as u,f as M,g as p,v as f,u as i,h as F,F as O,i as W,W as L,j as m,k as z}from"./app-2WV1baSo.js";const P={class:"min-h-screen bg-gray-50 py-6 px-4 sm:px-6 flex justify-center"},A={key:0,class:"w-full max-w-3xl bg-white rounded-2xl shadow-lg p-6 sm:p-8 grid grid-cols-1 md:grid-cols-2 gap-6"},Q={class:"space-y-4"},R={class:"text-xl sm:text-2xl font-bold text-center text-[#002B5C] mb-4"},H={key:0,class:"bg-red-100 text-red-800 p-2 rounded-lg text-sm"},Y={key:1,class:"bg-red-100 text-red-800 p-2 rounded-lg text-sm"},G={key:0,class:"mt-4"},J={class:"text-sm font-semibold text-gray-700 mb-2"},K={class:"overflow-x-auto"},Z={key:0,class:"min-w-full bg-white border rounded"},ee={class:"px-2 py-1 text-sm"},te={class:"px-2 py-1 text-sm"},oe={key:1,class:"text-xs text-gray-500 italic"},se=["disabled"],ne={class:"space-y-4"},re={class:"flex justify-center"},le=["src"],ie={key:0,class:"flex justify-center"},ae=["src"],de={key:1,class:"text-red-600 font-medium text-center mt-10"},pe=j({__name:"Booking",props:{shop:{},errors:{},bookings:{}},setup(T){const c=T,n=I({name:"",email:"",size_of_the_car:"",contact_no:"",time_of_booking:"",date_of_booking:"",slot_number:1}),g=w(""),b=w(""),k=w(c.bookings||[]),C=v(()=>n.date_of_booking?new Date(n.date_of_booking).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),x=v(()=>{if(!n.date_of_booking)return[];const o=n.date_of_booking,e=k.value.filter(l=>l.date_of_booking===o),s={};return e.forEach(l=>{const r=`${l.time_of_booking}-${l.slot_number}`;s[r]||(s[r]={id:l.id,time:l.time_of_booking,slot:l.slot_number,takenBy:""}),l.name?s[r].takenBy=s[r].takenBy&&s[r].takenBy!==l.name?"Multiple":l.name:s[r].takenBy||(s[r].takenBy="Unknown")}),Object.values(s).sort((l,r)=>new Date(`2000-01-01T${l.time}:00`).getTime()-new Date(`2000-01-01T${r.time}:00`).getTime())}),D=v(()=>{if(!n.date_of_booking||!n.time_of_booking||!n.slot_number)return!1;const o=new Date(`${n.date_of_booking}T${n.time_of_booking}:00`),e=new Date(o.getTime()+3*60*60*1e3);return k.value.some(s=>{const l=new Date(`${s.date_of_booking}T${s.time_of_booking}:00`),r=new Date(l.getTime()+3*60*60*1e3);return s.slot_number===n.slot_number&&l<e&&o<r})}),B=async o=>{var l;if(!o||!((l=c.shop)!=null&&l.id))return;const e=[new Date(o),new Date(o).setDate(new Date(o).getDate()-1),new Date(o).setDate(new Date(o).getDate()+1)].map(r=>new Date(r).toISOString().split("T")[0]),s=[];for(const r of[...new Set(e)])try{const y=await z.get(`/shops/${c.shop.id}/availability?date=${r}`);s.push(...y.data.bookings)}catch{}k.value=s.filter((r,y,X)=>y===X.findIndex(h=>h.date_of_booking===r.date_of_booking&&h.time_of_booking===r.time_of_booking&&h.slot_number===r.slot_number))},V=()=>L.visit(route("dashboard")),q=()=>{var o;if(g.value="",b.value="",!((o=c.shop)!=null&&o.id)){g.value="Invalid shop ID";return}if(D.value){b.value="This slot is already booked";return}n.post(`/customer/book/${c.shop.id}/payment`)},U=window.location.origin;function N(o){var e;return(e=o.logo)!=null&&e.startsWith("http")?o.logo:`/storage/${o.logo}`||"/images/default-carwash.png"}function E(o){var e;return(e=o.qr_code)!=null&&e.startsWith("http")?o.qr_code:`/storage/${o.qr_code}`||""}function S(o){const e=o.target;e&&(e.src=`${U}/images/default-carwash.png`)}return $(()=>n.date_of_booking,B),$(()=>c.shop,o=>{o!=null&&o.id&&n.date_of_booking&&B(n.date_of_booking)}),(o,e)=>(d(),a("div",P,[o.shop?(d(),a("div",A,[t("div",Q,[t("h1",R,"Book at "+u(o.shop.name),1),g.value?(d(),a("div",H,u(g.value),1)):_("",!0),b.value?(d(),a("div",Y,u(b.value),1)):_("",!0),t("form",{onSubmit:M(q,["prevent"]),class:"space-y-4"},[p(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>i(n).name=s),placeholder:"Your Name",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,i(n).name]]),p(t("input",{type:"email","onUpdate:modelValue":e[1]||(e[1]=s=>i(n).email=s),placeholder:"Email Address",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,i(n).email]]),p(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>i(n).size_of_the_car=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},[...e[8]||(e[8]=[t("option",{value:""},"Select Car Types",-1),t("option",null,"HatchBack",-1),t("option",null,"Sedan",-1),t("option",null,"MPV",-1),t("option",null,"SUV",-1),t("option",null,"Pickup",-1),t("option",null,"Van",-1),t("option",null,"Motorcycle",-1)])],512),[[F,i(n).size_of_the_car]]),p(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=s=>i(n).contact_no=s),placeholder:"09XXXXXXXXX",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:"",maxlength:"11",pattern:"\\d{11}",onInput:e[4]||(e[4]=s=>i(n).contact_no=i(n).contact_no.replace(/[^0-9]/g,""))},null,544),[[f,i(n).contact_no]]),p(t("input",{type:"time","onUpdate:modelValue":e[5]||(e[5]=s=>i(n).time_of_booking=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,i(n).time_of_booking]]),p(t("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=s=>i(n).date_of_booking=s),class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,i(n).date_of_booking]]),p(t("input",{type:"number","onUpdate:modelValue":e[7]||(e[7]=s=>i(n).slot_number=s),min:"1",max:"4",class:"w-full p-2 border rounded focus:ring-2 focus:ring-[#002B5C]",required:""},null,512),[[f,i(n).slot_number]]),i(n).date_of_booking?(d(),a("div",G,[t("h3",J,"Taken Slots on "+u(C.value)+" (View Only)",1),t("div",K,[x.value.length?(d(),a("table",Z,[e[10]||(e[10]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",null,"Time"),t("th",null,"Slot"),t("th",null,"Status")])],-1)),t("tbody",null,[(d(!0),a(O,null,W(x.value,s=>(d(),a("tr",{key:`${s.time}-${s.slot}-${s.id||0}`,class:"bg-red-50 border-l-4 border-red-400"},[t("td",ee,u(s.time),1),t("td",te,"#"+u(s.slot),1),e[9]||(e[9]=t("td",{class:"px-2 py-1 text-sm text-red-600 font-semibold"},"Taken",-1))]))),128))])])):(d(),a("p",oe,"No taken slots yet."))])])):_("",!0),t("button",{type:"button",onClick:V,class:"w-full bg-gray-500 text-white py-2 rounded hover:bg-gray-600 transition"},"Return"),t("button",{type:"submit",class:"w-full bg-[#FF2D2D] text-white py-2 rounded hover:bg-red-700 transition",disabled:i(n).processing||D.value},"Pay Now",8,se)],32)]),t("div",ne,[e[16]||(e[16]=t("h2",{class:"text-lg font-semibold text-[#002B5C] mb-2"},"Shop Details",-1)),t("div",re,[t("img",{src:N(o.shop),alt:"Car Wash Logo",class:"h-20 w-20 object-contain mb-2",onError:S},null,40,le)]),t("p",null,[e[11]||(e[11]=t("span",{class:"font-semibold"},"Name:",-1)),m(" "+u(o.shop.name),1)]),t("p",null,[e[12]||(e[12]=t("span",{class:"font-semibold"},"Address:",-1)),m(" "+u(o.shop.address),1)]),t("p",null,[e[13]||(e[13]=t("span",{class:"font-semibold"},"District:",-1)),m(" "+u(o.shop.district||"Not specified"),1)]),t("p",null,[e[14]||(e[14]=t("span",{class:"font-semibold"},"Description:",-1)),m(" "+u(o.shop.description||"No description"),1)]),t("p",null,[e[15]||(e[15]=t("span",{class:"font-semibold"},"Services Offered:",-1)),m(" "+u(o.shop.services_offered||"No services listed"),1)]),o.shop.qr_code?(d(),a("div",ie,[t("img",{src:E(o.shop),alt:"QR Code",class:"h-20 w-20 object-contain",onError:S},null,40,ae)])):_("",!0)])])):(d(),a("div",de,"Shop not found."))]))}});export{pe as default};
